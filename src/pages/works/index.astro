---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { projects as fallbackProjects } from '../../data/content';
import { getProjects, isSanityConfigured } from '../../lib/sanity';

const sanityProjects = await getProjects();
const projects = sanityProjects.length
  ? sanityProjects.map((p) => ({
      ...p,
      slug: p.slug.current,
      teamMembers: p.teamMembers ?? [],
      impact: p.impact ?? [],
      isPrivate: Boolean(p.isPrivate),
    }))
  : fallbackProjects;
---
<BaseLayout title="Works">
  <section class="page">
    <h1>Works</h1>
    {!isSanityConfigured && <p class="notice">Using local fallback content. Connect Sanity env vars to load CMS content.</p>}
    <ul class="list">
      {projects.map((p) => (
        <li>
          <a href={`/works/${p.slug}`}>{p.title}</a>
          <div class="meta">
            {p.isPrivate && <span class="badge">Private</span>}
            {p.year && <span>{p.year}</span>}
          </div>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>

<style>
  .page { max-width: 900px; }
  h1 { margin: 0 0 1.5rem; font-size: clamp(1.7rem, 3.6vw, 2.6rem); letter-spacing: -0.02em; }
  .notice { color: var(--muted); font-size: .9rem; margin-bottom: 1rem; }
  .list { list-style: none; padding: 0; margin: 0; display: grid; }
  li {
    display: flex; justify-content: space-between; align-items: center; gap: 1rem;
    border-bottom: 1px solid var(--line); padding: 0.95rem 0;
  }
  a { color: var(--text); text-decoration: none; font-weight: 500; letter-spacing: -0.01em; }
  .meta { display: flex; align-items: center; gap: .6rem; color: var(--muted); font-size: .88rem; }
  .badge { border: 1px solid var(--line); padding: .15rem .48rem; border-radius: 999px; }
</style>
