---
import BaseLayout from '../layouts/BaseLayout.astro';
import { home, playground, thoughts as fallbackThoughts } from '../data/content';
import { getPosts } from '../lib/sanity';

const sanityPosts = await getPosts();
const writing = (sanityPosts.length
  ? sanityPosts.map((p) => ({
      slug: p.slug.current,
      title: p.title,
      publishedAt: (p.publishedAt || '').slice(0, 10),
    }))
  : fallbackThoughts.map((p) => ({
      slug: p.slug,
      title: p.title,
      publishedAt: p.publishedAt,
    }))
).sort((a, b) => (a.publishedAt < b.publishedAt ? 1 : -1));
---

<BaseLayout>
  <section class="hero">
    <div>
      <h1>{home.intro}</h1>
      <p class="lead">{home.body}</p>
    </div>
    <img
      src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1000&q=80"
      alt="Portrait"
      loading="lazy"
    />
  </section>

  <section class="section split">
    <h2>Projects</h2>
    <p>Coming soon</p>
  </section>

  <section class="section split">
    <h2>Playground</h2>
    <div class="cards">
      {playground.map((item) => (
        <article>
          <img src={item.thumb} alt={item.title} loading="lazy" />
          <h3>{item.title}</h3>
          <p>{item.caption}</p>
        </article>
      ))}
    </div>
  </section>

  <section class="section split">
    <h2>Writings</h2>
    <ul class="writing-list">
      {writing.map((post, idx) => (
        <li class={idx === writing.length - 1 ? 'last' : ''}>
          <span>{post.publishedAt}</span>
          <a href={`/thoughts/${post.slug}`}>{post.title}</a>
        </li>
      ))}
    </ul>
  </section>

  <section class="section split about-more">
    <h2>More</h2>
    <p>{home.longBio}</p>
  </section>
</BaseLayout>

<style>
  .hero {
    padding-top: 1.2rem;
    display: grid;
    grid-template-columns: 1.2fr .8fr;
    gap: 1.5rem;
    align-items: end;
  }
  .hero img { width: 100%; border-radius: .2rem; aspect-ratio: 4 / 3; object-fit: cover; }
  h1 { margin: 0 0 1rem; font-size: clamp(1.75rem, 4.2vw, 3.35rem); line-height: 1.05; letter-spacing: -.026em; font-weight: 600; }
  .lead { margin: 0; max-width: 72ch; color: var(--muted); font-size: 1rem; }

  .section { border-top: 1px solid var(--line); margin-top: 2.2rem; padding-top: 1.1rem; }
  .split { display: grid; grid-template-columns: 160px 1fr; gap: 1.4rem; }
  .split h2 { margin: .15rem 0 0; font-family: Inter, sans-serif; font-size: .9rem; font-weight: 600; letter-spacing: -.01em; }

  .cards { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 1rem; }
  .cards article { border: 1px solid var(--line); border-radius: .3rem; padding: .45rem; background: var(--surface); }
  .cards img { width: 100%; aspect-ratio: 16/10; object-fit: cover; border-radius: .2rem; }
  .cards h3 { margin: .5rem 0 .2rem; font-family: Inter, sans-serif; font-size: .95rem; }
  .cards p { margin: 0; color: var(--muted); font-size: .86rem; }

  .writing-list { list-style: none; margin: 0; padding: 0; display: grid; }
  .writing-list li { display: grid; grid-template-columns: 120px 1fr; gap: 1rem; padding: .65rem 0; border-bottom: 1px solid var(--line); }
  .writing-list li.last { border-bottom: 0; }
  .writing-list span { color: var(--muted); font-size: .83rem; }
  .writing-list a { color: var(--text); text-decoration: none; font-size: .95rem; }

  .about-more p { margin: 0; color: var(--muted); line-height: 1.8; max-width: 74ch; }

  @media (max-width: 860px) {
    .hero { grid-template-columns: 1fr; }
    .split { grid-template-columns: 1fr; }
    .cards { grid-template-columns: 1fr; }
    .writing-list li { grid-template-columns: 1fr; gap: .3rem; }
  }
</style>
