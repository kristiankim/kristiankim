---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { thoughts as fallbackThoughts } from '../../data/content';
import { getPosts, isSanityConfigured } from '../../lib/sanity';

const sanityPosts = await getPosts();
const thoughts = sanityPosts.length
  ? sanityPosts.map((p) => ({
      slug: p.slug.current,
      title: p.title,
      category: p.category || 'Thoughts',
      publishedAt: (p.publishedAt || '').slice(0, 10),
      sections: [],
    }))
  : fallbackThoughts;
---
<BaseLayout title="Thoughts">
  <h1>Thoughts</h1>
  {!isSanityConfigured && <p class="notice">Using local fallback content. Connect Sanity env vars to load CMS content.</p>}
  <ul class="list">
    {thoughts.map((post) => (
      <li>
        <a href={`/thoughts/${post.slug}`}>{post.title}</a>
        <span>{post.publishedAt}</span>
      </li>
    ))}
  </ul>
</BaseLayout>

<style>
.notice{color:var(--muted);font-size:.9rem}.list{list-style:none;padding:0;display:grid;gap:1rem}li{display:flex;justify-content:space-between;gap:1rem;border-bottom:1px solid var(--line);padding:.75rem 0}span{color:var(--muted);font-size:.9rem}a{color:var(--text);text-decoration:none}
</style>
